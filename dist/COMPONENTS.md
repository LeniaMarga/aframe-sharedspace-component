# Component overview

When installing `sharedspace`, four components are registered with A-Frame:

| Component         | Description                                          |
|-------------------|------------------------------------------------------|
| `sharedspace`     | Provides the participation model.                    |
| `participants`    | Represent participants as A-Frame entities.          |
| `share`           | Controls the state of the participant to share.      |
| `position-around` | Helper to position an entity around a central point. |

## sharedspace

This component provides the participation model: a named room with participants entering and leaving. Participants can send arbitrary data to other participants or share audio with all of them. We refer to the participant representing the user as the _local participant_, while other people in the room are _remote participants_, _peers_ or simply, _participants_.

### Properties

| Property   | Description                                     | Default |
|------------|-------------------------------------------------|---------|
| `hold`     | If set, prevents the component from connecting. | `false` |
| `provider` | URL to the signaling server. | `https://salvadelapuente.com:9000` |
| `room`     | Room name. | [`room-101`](http://matrix.wikia.com/wiki/Room_101) |
| `audio`    | If set, will ask for user media.                | `false` |
| `me`       | User unique id. Randomly generated by default.  | `''`    |

Set the `hold` property to `true` to prevent the component from joining the room. While holding, configure the component and connect by setting `hold` to `false`. Notice that changing the properties once the `sharedspace` component has connected has no effect.

Use this technique to generate room links and share them with your friends, or to join specific rooms. Consider the following snippet as reference:

```html
<a-scene>
  <a-entity sharedspace="hold: true">
    <!-- Your room -->
  </a-entity>
<a-scene>

<script>
  var room = document.querySelector('[sharedspace]');
  var roomName = window.location.search.substr(1);
  if (!roomName) {
    roomName = Date.now() + '';
    history.pushState({}, '', window.location + '?' + roomName);
  }
  connect();

  function connect() {
    var scene = document.querySelector('a-scene');
    if (!scene.hasLoaded) {
      scene.addEventListener('loaded', connect);
      return;
    }
    room.setAttribute('sharedspace', { room: roomName, hold: false });
  }
</script>
```

### Methods

#### `isConnected()`

Returns `true` if the local participant has connected to the **signaling server**. It does not guarantee that the local participant can join the room.

You can consider the component effectively connected after receiving your `enterparticipant` event (i.e. that with the `isMe` property set to `true`).

```js
// <a-entity sharedspace></a-entity>
var room = document.querySelector('[sharedspace]');
room.components.sharedspace.isConnected();
```

#### `send(target, message)`

Send a [JSON-serializable](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) `message` to the participant with `target` id. Use `*` as `target` to broadcast the message to all remote participants.

```js
// <a-entity sharedspace></a-entity>
var room = document.querySelector('[sharedspace]');
room.components.sharedspace.send('*', { myName: 'Salva' });
```

### Events

| Name                 | Description                                       |
|----------------------|---------------------------------------------------|
| `enterparticipant`   | The local or a remote participant joins the room. |
| `exitparticipant`    | A remote participant exits the room.              |
| `participantstream`  | A remote participant shares audio.                |
| `participantmessage` | A remote participant sends a message.             |

Events `participantstream` and `participantmessage` for a participant are guaranteed to be received after the `enterparticipant` event of the same participant. Otherwise is a [bug](https://github.com/delapuente/aframe-sharedspace-component/issues).

All the events are emitted in the component's element:

```js
// <a-entity sharedspace></a-entity>
var room = document.querySelector('[sharedspace]');
room.addEventListener('enterparticipant', function (evt) {
  var detail = evt.detail;
  console.log(detail.id + 'entered with position ' + detail.position);
});
```

#### Detail

| Name                 | Detail     | Description                           |
|----------------------|----------------------------------------------------|
| `enterparticipant`   | `id`       | Participant unique id.                |
|                      | `position` | Order in the room.                    |
|                      | `isMe`     | `true` if it's the local participant. |

| `exitparticipant`    | `id`       | Participant unique id.                |
|                      | `position` | Order in the room.                    |
|                      | `isMe`     | `true` if it's the local participant. |

| `participantstream`  | `id`       | Participant unique id.                |
|                      | `stream`   | [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream) object                    |

| `participantmessage` | `id`       | Participant unique id.                |
|                      | `message`  | Message                    |

## participants

The `sharedspace` component is useless when used in isolation, but provides the necessary hooks for creating multi-user experiences. To use `sharedspace` in an effective way, your application should listen to the aforementioned events and translate them into changes in the A-Frame scene. The `participants` component does this in a configurable and powerful way.
